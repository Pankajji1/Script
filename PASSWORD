<?php

function getRandomSctgKey1() {
    $keys = array(
        "amyvdvucvv",
        "cpxrgdgbir",
        "vmcqizzxpa",
        "ryqrdytpqz",
        "fgwgmvdnut",
        "mrppmwxmmi",
        "njrnwubbpa",
        "awkrbzccgw",
        "mbcjyikxnz",
        "kvpeyuhtep",
        "twqttiawge",
        "gjmfjqruzt",
        "gtimntwwyi",
        "mnjnpbcdvt",
        "dakyzcdaiq",
        "wrqxitvvbm",
        "jakxpahiwm",
        "dgufriwzfn",
        "bbtdxtnarc",
        "xihuiypeqz",
        "fajiwkafwr",
        "qjejtwhdkc",
        "yheztumuqk",
        "gnhbfuqqiy",
        "vfhrajijda",
        "hqqtcatphz",
        "ywxanfkmud",
        "xaqmcupnia",
        "hqzkgdugmm",
        "gzgtbbjrzq"   );
    return $keys[array_rand($keys)];
}

$Newkey = getRandomSctgKey1();

// cURL call for shortened URL
$ch = curl_init("https://arlinks.in/api?api=964ff3f2709f625ec592c7504952926c8f2f8ab2&url=https://pankajxscripts.blogspot.com/p/your-access-key-$Newkey-copy-created.html?m=1");
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HEADER, 0);
$data = curl_exec($ch);

if(curl_errno($ch)){
    die('❌ cURL Error: ' . curl_error($ch));
}
curl_close($ch);

$shortenedUrl = json_decode($data,true)["shortenedUrl"] ?? "https://pankajxscripts.blogspot.com/p/your-access-key-$Newkey-copy-created.html?m=1";

// टर्मिनल साफ़ करें
@system(strtoupper(substr(PHP_OS, 0, 3)) === 'WIN' ? "cls" : "clear");

// ANSI कलर सेट करें
$blue = "\033[1;34m";   
$green = "\033[1;32m";  
$red = "\033[1;31m";    
$reset = "\033[0m";     

// ASCII आर्ट
echo $blue . "
  _____                                   
 |  __ \                                  
 | |__) |_ _ ___ _____   _____ _ __ __ _  
 |  ___/ _` / __/ __ \ \ / / _ \ '__/ _` | 
 | |  | (_| \__ \__ \ V /  __/ | | (_| |  
 |_|   \__,_|___/___/ \_/ \___|_|  \__,_|  
\n" . $reset;

// Link print
echo "🔗 Link Password: " . $green . $shortenedUrl . "\n" . $reset;

// Password input
function getPassword() {
    echo "[+] Enter Key: ";
    return trim(fgets(STDIN));
}

// Password check (fixed)
function checkPassword() {
    global $Newkey;
    $attempt = getPassword();

    // Trim spaces and case-insensitive check
    if (trim($attempt) === trim($Newkey)) {
        echo "\033[1;32m✅ Password correct!\n\033[0m";
        sleep(1);
        file_put_contents("key", password_hash($Newkey, PASSWORD_BCRYPT));
        return true;
    }

    echo "\033[1;31m❌ Wrong password!\n\033[0m";
    return false;
}

// Expiry time check
$expiryTime = 21600; // 6 hours
$file = "key";
if (file_exists($file) && (time() - filemtime($file) > $expiryTime)) {
    unlink($file); // Expired
}

// First password check
if (!checkPassword()) {
    // Remove old key if exists
    if (file_exists($file)) unlink($file);

    // Loop until correct password entered
    while (!checkPassword()) {
        sleep(1);
    }
}

echo "✅ Access Granted!\n";
