<?php
// ---------------- PHP Termux Token Generator + Shortlink ----------------
$secret = "MY_SECRET_KEY"; // same à¤°à¤–à¤¨à¤¾

function generateToken($secret) {
    $slot = floor(time() / 600); // à¤¹à¤° 10 à¤®à¤¿à¤¨à¤Ÿ à¤®à¥‡à¤‚ à¤¨à¤¯à¤¾
    return strtoupper(substr(hash('sha256', $secret . $slot), 0, 12));
}

$token = generateToken($secret);
$baseURL = "http://pankajxscripts.unaux.com/index.php";
$fullURL = $baseURL . "?token=" . $token;
echo "$fullURL";
sleep (2222);
// Shortlink API
$ch = curl_init("https://linkforearn.com/api?api=69ca6d487bdcd1d6c5034f0eb269547affb9f0d4&level=65&url=".urlencode($fullURL));
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HEADER, 0);
$data = curl_exec($ch);
curl_close($ch);

$shortenedUrl = json_decode($data,true)["shortenedUrl"] ?? "ERROR_CREATING_LINK";

// à¤Ÿà¤°à¥à¤®à¤¿à¤¨à¤² à¤¸à¤¾à¤«à¤¼ à¤•à¤°à¥‡à¤‚
@system(strtoupper(substr(PHP_OS, 0, 3)) === 'WIN' ? "cls" : "clear");

// ANSI à¤•à¤²à¤°
$blue = "\033[1;34m";   
$green = "\033[1;32m";  
$red = "\033[1;31m";    
$reset = "\033[0m";     

// ASCII à¤†à¤°à¥à¤Ÿ
echo $blue . "
  _                                   
 |  __ \                                  
 | |) |_ _ _ _   _ _   _  
 |  ___/ _ / __/ __ \ \ / / _ \ '__/ _ | 
 | |  \ \__ \__ \ V /  __/ | | (_| |  
,_|\__/ \_/ \ \_/ \___|_|  \__,_|  
\n" . $reset;

// Link print
echo "ðŸ”— Link Password: " . $green . $shortenedUrl . "\n" . $reset;

// Password input
function getPassword() {
    echo "[+] Enter Key: ";
    return trim(fgets(STDIN));
}

// Password check
function checkPassword() {
    global $token;
    $attempt = getPassword();

    if (trim($attempt) === trim($token)) {
        echo "\033[1;32mâœ… Password correct!\n\033[0m";
        sleep(1);
        file_put_contents("key", password_hash($token, PASSWORD_BCRYPT));
        return true;
    }

    echo "\033[1;31mâŒ Wrong password!\n\033[0m";
    return false;
}

// Expiry time check
$expiryTime = 21600; // 6 hours
$file = "key";
if (file_exists($file) && (time() - filemtime($file) > $expiryTime)) {
    unlink($file); // Expired
}

// First password check
if (!checkPassword()) {
    if (file_exists($file)) unlink($file);
    while (!checkPassword()) {
        sleep(1);
    }
}

echo "âœ… Access Granted!\n";
